# Fant√¥me de la Vanille

## Description

Un agent infiltr√© dans le r√©seau de la R√©union a transmis cette image avant de dispara√Ætre. > Les analystes pensent qu'un message critique est dissimul√© √† l'int√©rieur. > Ils ont trouv√© quelque chose... mais ce n'√©tait pas le bon message. > **Cherchez plus profond√©ment

## Analyse

Le challenge fournit un fichier image nomm√© `fantome_vanille.png`. L‚Äôimage repr√©sente un ciel √©toil√© sur un fond en d√©grad√© bleu vers vert.

### M√©tadonn√©es

On commence par examiner les m√©tadonn√©es du fichier avec `exiftool` qui r√©v√®le deux commentaires int√©gr√©s dans l'image

```bash
exiftool fantome_vanille.png 
```
```console
Author                          : OCOI2026
Comment                         : This image was generated by OCOI CTF system v2.6
```

### Donn√© cach√©
`zsteg` permet de d√©tecter des donn√©es cach√©es dans les plans de bits (LSB/MSB) d'une image PNG.

```bash
zsteg fantome_vanille.png 
```
```console
meta Author         .. text: "OCOI2026"
meta Comment        .. text: "This image was generated by OCOI CTF system v2.6"
chunk:0:IHDR        .. file: Lotus unknown worksheet or configuration, revision 0
chunk:1:ocOI        .. text: "author=OCOI2026"
b1,r,lsb,xy         .. text: "CCOI26{n0t_th3_r34l_fl4g_k33p_d1gg1ng}"
```
- Faux flag d√©tect√©: `CCOI26{n0t_th3_r34l_fl4g_k33p_d1gg1ng}` 

La description du challenge pr√©vient d'ailleurs explicitement, et le contenu du flag lui-m√™me nous demande de continuer √† chercher.

- Chunk PNG personnalis√© ‚Äî `chunk:1:ocOI`

Le chunk `ocOI` n‚Äôappartient pas √† la liste des chunks PNG standards d√©finis par la sp√©cification officielle. De plus son nom fait r√©f√©rence √† `OCOI` comme nom du CTF.

## Extraction du contenu du chunk personnalis√©

Chaque chunk dans un fichier PNG suit la structure suivante :

```console
4 octets : taille du contenu
4 octets : type (ex: IHDR, IDAT, IEND)
N octets : contenu
4 octets : CRC (contr√¥le d'erreur)
```

### Localisation du chunk
Pour trouver le chunk `ocOI`, on recherche son type directement dans le fichier binaire :
```bash
grep -aob "ocOI" fantome_vanille.png
```
```console
37:ocOI
```
- Le type `ocOI` est trouv√© √† l'offset 37
- Le chunk commence 4 octets avant pour contenir la longueur donc `37 - 4 = 33`

On v√©rifie la longueur du chunk :
```bash
xxd -s 33 -l 8 fantome_vanille.png
```
```console
00000021: 0000 0086 6f63 4f49  ....ocOI
```
La longueur vaut `0x86` soit **134 octets** de donn√©es.

### Extraction
Les donn√©es commencent √† l'offset `37 + 4 = 41` (apr√®s les 4 octets du type) :
```bash
dd if=fantome_vanille.png bs=1 skip=41 count=134 2>/dev/null
```
```console
author=OCOI2026hint=WE9SKGZsYWcsIE1ENShBdXRob3JfbWV0YWRhdGEpKQ==payload=ymHNxXIjUXxF0TlCNoBCsLxOtuIkSlk5Es07WgWFc975Tra9LkpZOxbXfFM=
```
Le contenu du chunk r√©v√®le trois champs :
- `author` : `OCOI2026` ‚Äî confirme la valeur trouv√©e dans les m√©tadonn√©es
- `hint` : une cha√Æne encod√©e en base64
- `payload` : des donn√©es chiffr√©es, √©galement en base64

### Decodage du chunk
On d√©code le hint en base64 :
```bash
echo "WE9SKGZsYWcsIE1ENShBdXRob3JfbWV0YWRhdGEpKQ==" | base64 -d
```
```console
XOR(flag, MD5(Author_metadata))
```
Le hint nous r√©v√®le l'algorithme utilis√© pour chiffrer le flag :
le payload est le r√©sultat d'un **XOR entre le flag et le hash MD5 de la m√©tadonn√©e
`Author`**

```python
import base64, hashlib

author = 'OCOI2026'
key = hashlib.md5(author.encode()).digest()

payload = base64.b64decode('ymHNxXIjUXxF0TlCNoBCsLxOtuIkSlk5Es07WgWFc975Tra9LkpZOxbXfFM=')

flag = bytes([payload[i] ^ key[i % len(key)] for i in range(len(payload))])
print('flag:', flag)
```

- Et le flag est la sortie du commande

### üë§ Auteur

AdminLegend